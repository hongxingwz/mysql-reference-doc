# 总：Mysql事务

## 事务的特征
以下内容出处《高性能MySQL》第三版，了解事务的ACID及四种隔离级别有助于我们更好的理解事务动作。

下面举一个银行应用是解释事务必要性的一个经典的例子。假如一个很行的数据库有两张表：支票表(checking)和储蓄表(savings)。现在要从用户Jane的支票帐户转移200美元到她的储蓄帐户，那么至少需要三个步骤：

 * 检查支票帐户的余额高于或等于200美元
 * 从支票帐户余额中减去200美元。
 * 在储蓄帐户余额中增加200美元。
 
上述三个步骤的操作必须打包在一个事务中，任何一个步骤失败，则必须回滚所有的步骤。

可以用START TRANSACTION语句开始一个事务，然后要么使用COMMIT提交将修改的数据持久保存，要么使用ROLLBACK撤销所有的修改。事务SQL的样本如下：


```
1. start transaction
2. select balance from checking where customer_id=10233276
3. update checking set balance= balance-200.00 where customer_id=10233276
4 update savings set balance = balance + 200.00 where customer_id = 10233276
5. commit;
```



ACID

* 原子性（atomicity）

 一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行其中的一部分操作，这就是事务的原子性。
* 一致性（consistency）

 数据库总是从一个致性的状态转换到另一个一致性的状态。（在前面的例子中，一致性确保了，即使在执行第三，四条语句之间时系统崩溃，支票帐户中也不会损失200美元，因为事务最终没有提交，所以事务中所做的修改也不会保存取数据库中）
* 隔离性（isolation）

  通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。（在前面的例子中，当执行完第三条语句，第四条语句还未开始，此时有另外的一个帐户汇总程序开始运行，则其看到支票帐户的余额并没有被减去200美元）
  
* 持久性（durability）

  一旦事务提交，则其所做的修改会永久保存到数据库。（此时即使系统崩溃，修改的数据也不会丢失。持久性是个有点模糊的概念，因为实际上持久性也分很多不同的级别。有些持久性策略能够提供非常强的安全保障，而有些则未必，而且不可能有做到100%的持久性保证的策略。）
  
  
## 事务的隔离级别

  



